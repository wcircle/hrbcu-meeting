<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zxy.hrbcu.meeting.dao.TUserReceiveDao" >
  <resultMap id="BaseResultMap" type="com.zxy.hrbcu.meeting.domain.TUserReceive" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MspCommentGenerator, do not modify.
    -->
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="user_id" property="userId" jdbcType="VARCHAR" />
    <result column="meeting_id" property="meetingId" jdbcType="VARCHAR" />
    <result column="wx_no" property="wxNo" jdbcType="VARCHAR" />
    <result column="bed_require" property="bedRequire" jdbcType="VARCHAR" />
    <result column="represent_college" property="representCollege" jdbcType="VARCHAR" />
    <result column="work" property="work" jdbcType="VARCHAR" />
    <result column="is_private" property="isPrivate" jdbcType="VARCHAR" />
    <result column="is_send" property="isSend" jdbcType="VARCHAR" />
    <result column="arrive_type" property="arriveType" jdbcType="VARCHAR" />
    <result column="arrive_flight_no" property="arriveFlightNo" jdbcType="VARCHAR" />
    <result column="arrive_time" property="arriveTime" jdbcType="TIMESTAMP" />
    <result column="arrive_airport" property="arriveAirport" jdbcType="VARCHAR" />
    <result column="return_type" property="returnType" jdbcType="VARCHAR" />
    <result column="return_flight_no" property="returnFlightNo" jdbcType="VARCHAR" />
    <result column="return_time" property="returnTime" jdbcType="TIMESTAMP" />
    <result column="return_airport" property="returnAirport" jdbcType="VARCHAR" />
    <result column="state" property="state" jdbcType="INTEGER" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="create_staff_id" property="createStaffId" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="update_staff_id" property="updateStaffId" jdbcType="VARCHAR" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MspCommentGenerator, do not modify.
    -->
    id, user_id, meeting_id, wx_no, bed_require, represent_college, work, is_private, 
    is_send, arrive_type, arrive_flight_no, arrive_time, arrive_airport, return_type, 
    return_flight_no, return_time, return_airport, state, remark, create_staff_id, create_time, 
    update_staff_id, update_time
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MspCommentGenerator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from t_user_receive
    where id = #{id,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MspCommentGenerator, do not modify.
    -->
    delete from t_user_receive
    where id = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insertSelective" parameterType="com.zxy.hrbcu.meeting.domain.TUserReceive" >
    insert into t_user_receive
    <trim prefix="(" suffix=")" suffixOverrides="," >
      id,
      <if test="userId != null" >
        user_id,
      </if>
      <if test="meetingId != null" >
        meeting_id,
      </if>
      <if test="wxNo != null" >
        wx_no,
      </if>
      <if test="bedRequire != null" >
        bed_require,
      </if>
      <if test="representCollege != null" >
        represent_college,
      </if>
      <if test="work != null" >
        work,
      </if>
      <if test="isPrivate != null" >
        is_private,
      </if>
      <if test="isSend != null" >
        is_send,
      </if>
      <if test="arriveType != null" >
        arrive_type,
      </if>
      <if test="arriveFlightNo != null" >
        arrive_flight_no,
      </if>
      <if test="arriveTime != null" >
        arrive_time,
      </if>
      <if test="arriveAirport != null" >
        arrive_airport,
      </if>
      <if test="returnType != null" >
        return_type,
      </if>
      <if test="returnFlightNo != null" >
        return_flight_no,
      </if>
      <if test="returnTime != null" >
        return_time,
      </if>
      <if test="returnAirport != null" >
        return_airport,
      </if>
      <if test="state != null" >
        state,
      </if>
      <if test="remark != null" >
        remark,
      </if>
      <if test="createStaffId != null" >
        create_staff_id,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="updateStaffId != null" >
        update_staff_id,
      </if>
      <if test="updateTime != null" >
        update_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      #{id,jdbcType=VARCHAR},
      <if test="userId != null" >
        #{userId,jdbcType=VARCHAR},
      </if>
      <if test="meetingId != null" >
        #{meetingId,jdbcType=VARCHAR},
      </if>
      <if test="wxNo != null" >
        #{wxNo,jdbcType=VARCHAR},
      </if>
      <if test="bedRequire != null" >
        #{bedRequire,jdbcType=VARCHAR},
      </if>
      <if test="representCollege != null" >
        #{representCollege,jdbcType=VARCHAR},
      </if>
      <if test="work != null" >
        #{work,jdbcType=VARCHAR},
      </if>
      <if test="isPrivate != null" >
        #{isPrivate,jdbcType=VARCHAR},
      </if>
      <if test="isSend != null" >
        #{isSend,jdbcType=VARCHAR},
      </if>
      <if test="arriveType != null" >
        #{arriveType,jdbcType=VARCHAR},
      </if>
      <if test="arriveFlightNo != null" >
        #{arriveFlightNo,jdbcType=VARCHAR},
      </if>
      <if test="arriveTime != null" >
        #{arriveTime,jdbcType=TIMESTAMP},
      </if>
      <if test="arriveAirport != null" >
        #{arriveAirport,jdbcType=VARCHAR},
      </if>
      <if test="returnType != null" >
        #{returnType,jdbcType=VARCHAR},
      </if>
      <if test="returnFlightNo != null" >
        #{returnFlightNo,jdbcType=VARCHAR},
      </if>
      <if test="returnTime != null" >
        #{returnTime,jdbcType=TIMESTAMP},
      </if>
      <if test="returnAirport != null" >
        #{returnAirport,jdbcType=VARCHAR},
      </if>
      <if test="state != null" >
        #{state,jdbcType=INTEGER},
      </if>
      <if test="remark != null" >
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="createStaffId != null" >
        #{createStaffId,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateStaffId != null" >
        #{updateStaffId,jdbcType=VARCHAR},
      </if>
      <if test="updateTime != null" >
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.zxy.hrbcu.meeting.domain.TUserReceive" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MspCommentGenerator, do not modify.
    -->
    update t_user_receive
    <set >
      <if test="userId != null" >
        user_id = #{userId,jdbcType=VARCHAR},
      </if>
      <if test="meetingId != null" >
        meeting_id = #{meetingId,jdbcType=VARCHAR},
      </if>
      <if test="wxNo != null" >
        wx_no = #{wxNo,jdbcType=VARCHAR},
      </if>
      <if test="bedRequire != null" >
        bed_require = #{bedRequire,jdbcType=VARCHAR},
      </if>
      <if test="representCollege != null" >
        represent_college = #{representCollege,jdbcType=VARCHAR},
      </if>
      <if test="work != null" >
        work = #{work,jdbcType=VARCHAR},
      </if>
      <if test="isPrivate != null" >
        is_private = #{isPrivate,jdbcType=VARCHAR},
      </if>
      <if test="isSend != null" >
        is_send = #{isSend,jdbcType=VARCHAR},
      </if>
      <if test="arriveType != null" >
        arrive_type = #{arriveType,jdbcType=VARCHAR},
      </if>
      <if test="arriveFlightNo != null" >
        arrive_flight_no = #{arriveFlightNo,jdbcType=VARCHAR},
      </if>
        arrive_time = #{arriveTime,jdbcType=TIMESTAMP},
      <if test="arriveAirport != null" >
        arrive_airport = #{arriveAirport,jdbcType=VARCHAR},
      </if>
      <if test="returnType != null" >
        return_type = #{returnType,jdbcType=VARCHAR},
      </if>
      <if test="returnFlightNo != null" >
        return_flight_no = #{returnFlightNo,jdbcType=VARCHAR},
      </if>
        return_time = #{returnTime,jdbcType=TIMESTAMP},
      <if test="returnAirport != null" >
        return_airport = #{returnAirport,jdbcType=VARCHAR},
      </if>
      <if test="state != null" >
        state = #{state,jdbcType=INTEGER},
      </if>
      <if test="remark != null" >
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="createStaffId != null" >
        create_staff_id = #{createStaffId,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateStaffId != null" >
        update_staff_id = #{updateStaffId,jdbcType=VARCHAR},
      </if>
      <if test="updateTime != null" >
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <sql id="sql_where" >
    <where >
      <if test="userId != null" >
         and user_id = #{userId,jdbcType=VARCHAR}
      </if>
      <if test="meetingId != null" >
         and meeting_id = #{meetingId,jdbcType=VARCHAR}
      </if>
      <if test="wxNo != null" >
         and wx_no = #{wxNo,jdbcType=VARCHAR}
      </if>
      <if test="bedRequire != null" >
         and bed_require = #{bedRequire,jdbcType=VARCHAR}
      </if>
      <if test="representCollege != null" >
         and represent_college = #{representCollege,jdbcType=VARCHAR}
      </if>
      <if test="work != null" >
         and work = #{work,jdbcType=VARCHAR}
      </if>
      <if test="isPrivate != null" >
         and is_private = #{isPrivate,jdbcType=VARCHAR}
      </if>
      <if test="isSend != null" >
         and is_send = #{isSend,jdbcType=VARCHAR}
      </if>
      <if test="arriveType != null" >
         and arrive_type = #{arriveType,jdbcType=VARCHAR}
      </if>
      <if test="arriveFlightNo != null" >
         and arrive_flight_no = #{arriveFlightNo,jdbcType=VARCHAR}
      </if>
      <if test="arriveTime != null" >
         and arrive_time = #{arriveTime,jdbcType=TIMESTAMP}
      </if>
      <if test="arriveAirport != null" >
         and arrive_airport = #{arriveAirport,jdbcType=VARCHAR}
      </if>
      <if test="returnType != null" >
         and return_type = #{returnType,jdbcType=VARCHAR}
      </if>
      <if test="returnFlightNo != null" >
         and return_flight_no = #{returnFlightNo,jdbcType=VARCHAR}
      </if>
      <if test="returnTime != null" >
         and return_time = #{returnTime,jdbcType=TIMESTAMP}
      </if>
      <if test="returnAirport != null" >
         and return_airport = #{returnAirport,jdbcType=VARCHAR}
      </if>
      <if test="state != null" >
         and state = #{state,jdbcType=INTEGER}
      </if>
      <if test="remark != null" >
         and remark = #{remark,jdbcType=VARCHAR}
      </if>
      <if test="createStaffId != null" >
         and create_staff_id = #{createStaffId,jdbcType=VARCHAR}
      </if>
      <if test="createTime != null" >
         and create_time = #{createTime,jdbcType=TIMESTAMP}
      </if>
      <if test="updateStaffId != null" >
         and update_staff_id = #{updateStaffId,jdbcType=VARCHAR}
      </if>
      <if test="updateTime != null" >
         and update_time = #{updateTime,jdbcType=TIMESTAMP}
      </if>
    </where>
  </sql>
  <select id="selectBySelective" resultMap="BaseResultMap" parameterType="com.zxy.hrbcu.meeting.domain.TUserReceive" >
     select * from t_user_receive
    <include refid="sql_where" />
  </select>

  <select id="getReceiveList" resultType="map" parameterType="map">
    SELECT
      u.id as userId,
      u.user_name as userName,
      u.phone as phone,
      u.id_no as idNo,
      r.id as receiveId,
      r.wx_no as wxNo,
      r.represent_college as representCollege,
      r.`work`,
      r.bed_require as bedRequire,
      r.is_send as isSend,
      r.arrive_type as arriveType,
      r.arrive_flight_no as arriveFlightNo,
      date_format(r.arrive_time, '%Y-%m-%d %H:%i:%s') as arriveTime,
      r.arrive_airport as arriveAirport,
      r.return_type as returnType,
      r.return_flight_no as returnFlightNo,
      date_format(r.return_time, '%Y-%m-%d %H:%i:%s') as returnTime,
      r.return_airport as returnAirport
    from t_user_receive r
    LEFT JOIN t_u_user u ON u.id = r.user_id
    <where>
        AND r.state = 1
      <if test="meetingId != null and meetingId != ''">
        AND r.meeting_id = #{meetingId}
      </if>
      <if test="isSend != null and isSend != ''">
        AND r.is_send = #{isSend}
      </if>
      <if test="isBedRequire != null and isBedRequire == '0'.toString()">
        AND r.bed_require = '3'
      </if>
      <if test="isBedRequire != null and isBedRequire == '1'.toString()">
        AND r.bed_require in ('1','2')
      </if>
      <if test="bedRequire != null and bedRequire != ''">
        AND r.bed_require = #{bedRequire}
      </if>
      <if test="userType != null and userType != ''">
        AND u.user_type = #{userType}
      </if>
      <if test="userName != null and userName != ''">
        AND u.user_name = #{userName}
      </if>
      <if test="phone != null and phone != ''">
        AND u.phone = #{phone}
      </if>
      <if test="representCollege != null and representCollege != ''">
        AND r.represent_college = #{representCollege}
      </if>
    </where>
    order by r.update_time desc,u.update_time desc
  </select>

  <update id="updateState" parameterType="map">
    update t_user_receive
    set state = #{changeState}
    where 1=1
    AND id IN
    <foreach item="item" index="index" collection="idList"
             open="(" separator="," close=")">
      #{item}
    </foreach>
  </update>

  <update id="updateRepresentCollege" parameterType="map">
    update t_user_receive
    set represent_college = #{newName}
    where represent_college = #{oldName}
  </update>

  <select id="getNoReceiveUserList" resultType="map" parameterType="map">
    SELECT
      u.id,
      u.user_name as userName
    from t_u_user u
    <where>
      not EXISTS (
        select *
        from t_user_receive r
        where u.id = r.user_id and r.state = 1
        <if test="meetingId != null and meetingId != ''">
          and r.meeting_id = #{meetingId}
        </if>
      )
    and u.user_type = 1
    </where>
  </select>

  <select id="getReceiveUserList" resultType="map" parameterType="map">
    SELECT
      r.id as receiveId,
      u.id as userId,
      u.user_name as userName,
      u.phone as phone
    FROM t_user_receive r
    LEFT JOIN t_u_user u on r.user_id = u.id
    <where>
      r.state = 1 and u.user_type = 1
      <if test="meetingId != null and meetingId != ''">
        and r.meeting_id = #{meetingId}
      </if>
    </where>

  </select>

  <select id="getReceiveCollegeCount" resultType="java.lang.Integer">
    SELECT count(DISTINCT(u.represent_college))
    from t_user_receive u
    where u.state = 1
  </select>

  <select id="getTodayCreateReceiveCount" resultType="java.lang.Integer">
    SELECT
     count(*)
    from t_user_receive u
    where
      date_format(u.create_time,'%Y-%m-%d') = date_format(NOW(), '%Y-%m-%d')
      and u.state = 1

  </select>

  <select id="getNeedSleepReceiveUserList" resultType="map" parameterType="map">
    SELECT
    r.id as receiveId,
    u.id as userId,
    u.user_name as userName,
    u.phone as phone
    FROM t_user_receive r
    LEFT JOIN t_u_user u on r.user_id = u.id
    <where>
      r.state = 1 and u.user_type = 1
      <if test="meetingId != null and meetingId != ''">
        and r.meeting_id = #{meetingId}
      </if>
      <if test="noBedRequire != null and noBedRequire != ''">
        and r.bed_require != #{noBedRequire}
      </if>
    </where>
  </select>

  <select id="getCollegeStatistics" resultType="map" parameterType="map">
    SELECT
      r.represent_college as representCollege,
      count(*) as receiveCount
    from t_user_receive r
    where r.state = 1 and r.meeting_id = 1
    GROUP BY r.represent_college;
  </select>

  <select id="getCollegeList" resultType="map" parameterType="map">
    <if test="collegeName != null and collegeName != ''">
      <bind name="collegeNamePattern" value="'%' + collegeName + '%'"/>
    </if>
    select
    c.id,
    c.name
    from t_meeting_college c
    <where>
      <if test="collegeName != null and collegeName != ''">
        AND c.name LIKE #{collegeNamePattern}
      </if>
    </where>
  </select>

</mapper>